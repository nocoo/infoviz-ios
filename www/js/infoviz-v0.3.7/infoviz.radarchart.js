define(function(b,a,c){b.async(["./infoviz.core"],function(d){a.draw_radarchart=function(z,t,N,r,o,u){if(!z||!N){return idb("Paper or Data is empty.")}var l=d.merge_options(r),C=[],A=[],w,v,I,G,J,m,M=Math.PI/180;var k=t["top-left"][0]+t.width/2+l.radarchart["horizontal-offset"];var h=t["top-left"][1]+t.height/2+l.radarchart["vertical-offset"];if(t.width>t.height){m=Math.floor(t.height/2)*l.radarchart["size-factor"]}else{m=Math.floor(t.width/2)*l.radarchart["size-factor"]}var f=0;var B=360/N.value_fields.length;var K={},L={};for(I=0;I<N.value_fields.length;++I){K[N.value_fields[I]]={v_max:-Infinity,v_min:Infinity};L[N.value_fields[I]]={angle:f};f+=B}for(I=0;I<N.data.length;++I){for(G=0;G<N.value_fields.length;++G){if(typeof(N.value_maxs)==="object"&&(N.value_maxs instanceof Array)){K[N.value_fields[G]]["v_max"]=N.value_maxs[G]}if(typeof(N.value_mins)==="object"&&(N.value_mins instanceof Array)){K[N.value_fields[G]]["v_min"]=N.value_mins[G]}J=N.data[I][N.value_fields[G]];if(J>K[N.value_fields[G]]["v_max"]){K[N.value_fields[G]]["v_max"]=J}if(J<K[N.value_fields[G]]["v_min"]){K[N.value_fields[G]]["v_min"]=J}}}z.circle(k,h,m).attr({stroke:l.radarchart["outer-border-color"],"stroke-width":l.radarchart["outer-border-width"],"stroke-opacity":l.radarchart["outer-border-alpha"],fill:l.radarchart["outer-background-color"],"fill-opacity":l.radarchart["outer-background-alpha"]}).translate(0.5,0.5);C=[];A=[];var g=0;for(I=0;I<N.value_fields.length;++I){if(I===0){C.push("M")}else{C.push("L")}w=k+m*Math.sin(L[N.value_fields[I]]["angle"]*M);v=h-m*Math.cos(L[N.value_fields[I]]["angle"]*M);L[N.value_fields[I]]["end-x"]=w;L[N.value_fields[I]]["end-y"]=v;C.push(w+","+v);A.push("M"+k+","+h+"L"+w+","+v);w=k+(m+l.radarchart["label-distance"])*Math.sin(L[N.value_fields[I]]["angle"]*M);v=h-(m+l.radarchart["label-distance"])*Math.cos(L[N.value_fields[I]]["angle"]*M);L[N.value_fields[I]]["label-x"]=w;L[N.value_fields[I]]["label-y"]=v;if(l.radarchart["label-rotation"]){g=L[N.value_fields[I]]["angle"];if(L[N.value_fields[I]]["angle"]>90&&L[N.value_fields[I]]["angle"]<270){g+=180}}z.text(w,v,N.value_fields[I]).attr({"font-size":l.radarchart["label-size"],fill:l.radarchart["label-color"],transform:"r"+g}).translate(0.5,0.5);K[N.value_fields[I]]["v_unit"]=(m-l.radarchart["circle-min-radius"])/(K[N.value_fields[I]]["v_max"]-K[N.value_fields[I]]["v_min"])}C.push("z");z.path(C.join("")).attr({stroke:l.radarchart["inner-border-color"],"stroke-width":l.radarchart["inner-border-width"],"stroke-opacity":l.radarchart["inner-border-alpha"],fill:l.radarchart["inner-background-color"],"fill-opacity":l.radarchart["inner-background-alpha"]}).translate(0.5,0.5);z.path(A.join("")).attr({stroke:l.radarchart["axis-color"],"stroke-width":l.radarchart["axis-width"],"stroke-opacity":l.radarchart["axis-alpha"]}).translate(0.5,0.5);var D=0,s,q,e=[],H,n=[];for(I=0;I<N.data.length;++I){s=l.color[(I%l.color.length)];C=[];for(G=0;G<N.value_fields.length;++G){q=N.data[I][N.value_fields[G]];D=l.radarchart["circle-min-radius"]+K[N.value_fields[G]]["v_unit"]*(q-K[N.value_fields[G]]["v_min"]);if(!D){continue}if(G===0){C.push("M")}else{C.push("L")}w=k+D*Math.sin(L[N.value_fields[G]]["angle"]*M);v=h-D*Math.cos(L[N.value_fields[G]]["angle"]*M);C.push(w+","+v)}C.push("z");H=z.path(C.join("")).attr({stroke:s.color,"stroke-width":l.radarchart["circle-border-width"],"stroke-opacity":s["dark-alpha"],fill:s.color,"fill-opacity":l.radarchart["circle-background-alpha"]}).translate(0.5,0.5);H.data("color-alpha",l.radarchart["circle-background-alpha"]);e.push(H);if(N.data[I][N.name_field]){n.push({label:N.data[I][N.name_field],color:s,type:"circle"})}if(o&&typeof(o)==="function"){H.data("info",{name:N.data[I][N.name_field],data:N.data[I],callback:o,that:u});H.click(d.element_action)}if(N.tooltip_title||N.tooltip_content){var O=N.tooltip_title;var F=N.tooltip_content;for(var E in N.data[I]){O=O.replace("{"+E+"}",N.data[I][E]);F=F.replace("{"+E+"}",N.data[I][E])}H.data("tooltip",{id:I,title:O,content:F,color:s,x:w,y:v,element:H,options:l,paper:z});H.hover(d.element_tooltip)}}d.draw_legend(z,t,n,l);for(I=0;I<e.length;++I){(function(i){i.mouseover(function(){i.animate({"fill-opacity":0.618},l.layout["speed"],"<")});i.mouseout(function(){i.animate({"fill-opacity":i.data("color-alpha")},l.layout["speed"],">")})})(e[I])}}})});