define(function(c,b,d){var a,f,h,e,g;b.draw_empty_background=function(k,n,j){if(!k){return idb("Paper is empty.")}var t=b.merge_options(j),o={},s=k.width,m=k.height,i=[],r,q;var l=k.rect(0,0,s,m);l.attr({stroke:"none",fill:t.layout["background-color"],"fill-opacity":t.layout["background-alpha"]});var p=k.rect(t.layout["padding-left"],t.layout["padding-top"],s-t.layout["padding-left"]-t.layout["padding-right"],m-t.layout["padding-top"]-t.layout["padding-bottom"],t.grid["border-radius"]);p.attr({stroke:t.grid["border-color"],"stroke-width":t.grid["border-width"],"stroke-opacity":t.grid["border-alpha"],fill:t.grid["background-color"],"fill-opacity":t.grid["background-alpha"]});p.translate(0.5,0.5);r=t.layout["padding-left"]+t.grid["border-width"]+t.grid["padding-left"];q=m-t.layout["padding-bottom"]-t.grid["border-width"]-t.grid["padding-bottom"];o["bottom-left"]=[r,q];q=t.layout["padding-top"]+t.grid["border-width"]+t.grid["padding-top"];o["top-left"]=[r,q];r=s-t.layout["padding-right"]-t.grid["border-width"]-t.grid["padding-right"];q=o["top-left"][1];o["top-right"]=[r,q];q=o["bottom-left"][1];o["bottom-right"]=[r,q];o.width=o["top-right"][0]-o["top-left"][0];o.height=o["bottom-right"][1]-o["top-right"][1];return o};b.draw_axis_background=function(q,D,m){if(!q){return idb("Paper is empty.")}var k=b.merge_options(m),n={},A=q.width,l=q.height,u=[],p,o;var B=q.rect(0,0,A,l);B.attr({stroke:"none",fill:k.layout["background-color"],"fill-opacity":k.layout["background-alpha"]});var r=q.rect(k.layout["padding-left"],k.layout["padding-top"],A-k.layout["padding-left"]-k.layout["padding-right"],l-k.layout["padding-top"]-k.layout["padding-bottom"],k.grid["border-radius"]);r.attr({stroke:k.grid["border-color"],"stroke-width":k.grid["border-width"],"stroke-opacity":k.grid["border-alpha"],fill:k.grid["background-color"],"fill-opacity":k.grid["background-alpha"]});r.translate(0.5,0.5);p=k.layout["padding-left"]+k.grid["border-width"]+k.grid["padding-left"]+k.grid["vertical-label-margin"]+k.grid["vertical-label-spacing"]+k.grid["vertical-label-margin"];o=l-k.layout["padding-bottom"]-k.grid["border-width"]-k.grid["padding-bottom"]-k.grid["horizontal-label-margin"]-k.grid["horizontal-label-spacing"]-k.grid["horizontal-label-margin"];n["bottom-left"]=[p,o];o=k.layout["padding-top"]+k.grid["border-width"]+k.grid["padding-top"];n["top-left"]=[p,o];p=A-k.layout["padding-right"]-k.grid["border-width"]-k.grid["padding-right"];if(k.grid["enable-right-axis"]){p-=k.grid["vertical-label-margin"]+k.grid["vertical-label-spacing"]+k.grid["vertical-label-margin"]}o=n["top-left"][1];n["top-right"]=[p,o];o=n["bottom-left"][1];n["bottom-right"]=[p,o];n.width=n["top-right"][0]-n["top-left"][0];n.height=n["bottom-right"][1]-n["top-right"][1];u=[];u.push("M"+n["bottom-left"][0]+","+n["bottom-left"][1]);u.push("L"+n["top-left"][0]+","+n["top-left"][1]);var E=q.path(u.join(""));E.attr({stroke:k.grid["axis-color"],"stroke-width":k.grid["axis-width"],"stroke-opacity":k.grid["axis-alpha"]});E.translate(0.5,0.5);if(k.grid["enable-right-axis"]){u=[];u.push("M"+n["bottom-right"][0]+","+n["bottom-right"][1]);u.push("L"+n["top-right"][0]+","+n["top-right"][1]);E=q.path(u.join(""));E.attr({stroke:k.grid["axis-color"],"stroke-width":k.grid["axis-width"],"stroke-opacity":k.grid["axis-alpha"]});E.translate(0.5,0.5)}u=[];u.push("M"+n["bottom-left"][0]+","+n["bottom-left"][1]);u.push("L"+n["bottom-right"][0]+","+n["bottom-right"][1]);var C=q.path(u.join(""));C.attr({stroke:k.grid["axis-color"],"stroke-width":k.grid["axis-width"],"stroke-opacity":k.grid["axis-alpha"]});C.translate(0.5,0.5);var w=q.circle(n["bottom-left"][0],n["bottom-left"][1],k.grid["axis-dot-size"]);w.attr({stroke:"none",fill:k.grid["axis-color"],"fill-opacity":k.grid["axis-alpha"]});w.translate(0.5,0.5);var i=q.circle(n["top-left"][0],n["top-left"][1],k.grid["axis-dot-size"]);i.attr({stroke:"none",fill:k.grid["axis-color"],"fill-opacity":k.grid["axis-alpha"]});i.translate(0.5,0.5);if(k.grid["enable-right-axis"]){var t=q.circle(n["top-right"][0],n["top-right"][1],k.grid["axis-dot-size"]);t.attr({stroke:"none",fill:k.grid["axis-color"],"fill-opacity":k.grid["axis-alpha"]});t.translate(0.5,0.5)}var s=q.circle(n["bottom-right"][0],n["bottom-right"][1],k.grid["axis-dot-size"]);s.attr({stroke:"none",fill:k.grid["axis-color"],"fill-opacity":k.grid["axis-alpha"]});s.translate(0.5,0.5);if(D.vertical_axis_name){p=n["top-left"][0]-k.grid["vertical-label-margin"]*2;o=n["top-left"][1]+k.grid["vertical-name-size"]/2;var j=q.text(p,o,D.vertical_axis_name);j.attr({"text-anchor":"end","font-weight":"bold","font-size":k.grid["vertical-name-size"],fill:k.grid["vertical-name-color"]})}if(D.vertical_axis_name_right){p=n["top-right"][0]+k.grid["vertical-label-margin"]*2;o=n["top-right"][1]+k.grid["vertical-name-size"]/2;var v=q.text(p,o,D.vertical_axis_name_right);v.attr({"text-anchor":"start","font-weight":"bold","font-size":k.grid["vertical-name-size"],fill:k.grid["vertical-name-color"]})}if(D.horizontal_axis_name){p=n["bottom-right"][0];o=n["bottom-right"][1]+k.grid["horizontal-name-size"]/2+k.grid["horizontal-label-margin"]*2;var z=q.text(p,o,D.horizontal_axis_name);z.attr({"text-anchor":"end","font-weight":"bold","font-size":k.grid["horizontal-name-size"],fill:k.grid["horizontal-name-color"]})}return n};b.draw_legend=function(t,p,n,o){if(!t||!n){return idb("Paper or Data is empty.")}var m=b.merge_options(o),v=[],s,r,D,C,F;if(!m.legend["legend-enabled"]){return}var z=m.legend["width"],w=m.legend["height"];if(!z){var B,l,q=-Infinity;for(D=0;D<n.length;++D){F=n[D];B=t.text(-1000,-1000,F.label).attr({"font-size":m.legend["label-size"]}).translate(0.5,0.5);l=B.getBBox();if(l.width>q){q=l.width}}z=q+m.legend["padding-left"]+m.legend["padding-right"]+m.legend["indicator-margin-left"]+m.legend["indicator-margin-right"]+m.legend["indicator-size"]}if(!w){w=m.legend["padding-top"]+m.legend["padding-bottom"];for(D=0;D<n.length;++D){w+=m.legend["indicator-margin-top"]+m.legend["indicator-margin-bottom"]+m.legend["indicator-size"]}}switch(m.legend["legend-position"]){default:case"top-right":s=p["top-right"][0]-z-m.legend["margin-right"];r=p["top-right"][1]+m.legend["margin-top"];break;case"top-left":s=p["top-left"][0]+m.legend["margin-left"];r=p["top-right"][1]+m.legend["margin-top"];break;case"bottom-left":s=p["bottom-left"][0]+m.legend["margin-left"];r=p["bottom-left"][1]-w-m.legend["margin-bottom"];break;case"bottom-right":s=p["bottom-right"][0]-z-m.legend["margin-right"];r=p["bottom-left"][1]-w-m.legend["margin-bottom"];break}var u=t.rect(s,r,z,w,m.legend["border-radius"]).attr({stroke:m.legend["border-color"],"stroke-opacity":m.legend["border-alpha"],"stroke-width":m.legend["border-width"],fill:m.legend["background-color"],"fill-opacity":m.legend["background-alpha"]}).translate(0.5,0.5);var k=[],A=[];var H,G;s+=m.legend["padding-left"];r+=m.legend["padding-top"];for(D=0;D<n.length;++D){F=n[D];switch(F.type){default:case"box":H=t.rect(s+m.legend["indicator-margin-left"],r+m.legend["indicator-margin-top"],m.legend["indicator-size"],m.legend["indicator-size"]).attr({fill:F.color["color"],"fill-opacity":F.color["light-alpha"],stroke:F.color["color"],"stroke-opacity":F.color["dark-alpha"],"stroke-width":m.legend["indicator-border-width"]}).translate(0.5,0.5);break;case"line":v=[];v.push("M"+(s+m.legend["indicator-margin-left"])+","+(r+m.legend["indicator-margin-top"]+m.legend["indicator-size"]));v.push("L"+(s+m.legend["indicator-margin-left"]+2*m.legend["indicator-size"]/5)+","+(r+m.legend["indicator-margin-top"]+2*m.legend["indicator-size"]/5));v.push("L"+(s+m.legend["indicator-margin-left"]+3*m.legend["indicator-size"]/4)+","+(r+m.legend["indicator-margin-top"]+5*m.legend["indicator-size"]/7));v.push("L"+(s+m.legend["indicator-margin-left"]+m.legend["indicator-size"])+","+(r+m.legend["indicator-margin-top"]));H=t.path(v.join("")).attr({stroke:F.color["color"],"stroke-opacity":F.color["dark-alpha"],"stroke-width":m.legend["indicator-border-width"]}).translate(0.5,0.5);break;case"area":v=[];v.push("M"+(s+m.legend["indicator-margin-left"])+","+(r+m.legend["indicator-margin-top"]+m.legend["indicator-size"]));v.push("L"+(s+m.legend["indicator-margin-left"]+2*m.legend["indicator-size"]/5)+","+(r+m.legend["indicator-margin-top"]+2*m.legend["indicator-size"]/5));v.push("L"+(s+m.legend["indicator-margin-left"]+4*m.legend["indicator-size"]/7)+","+(r+m.legend["indicator-margin-top"]+5*m.legend["indicator-size"]/7));v.push("L"+(s+m.legend["indicator-margin-left"]+m.legend["indicator-size"])+","+(r+m.legend["indicator-margin-top"]));v.push("L"+(s+m.legend["indicator-margin-left"]+m.legend["indicator-size"])+","+ +(r+m.legend["indicator-margin-top"]+m.legend["indicator-size"]));v.push("Z");H=t.path(v.join("")).attr({fill:F.color["color"],"fill-opacity":F.color["light-alpha"],stroke:F.color["color"],"stroke-opacity":F.color["dark-alpha"],"stroke-width":m.legend["indicator-border-width"]}).translate(0.5,0.5);break;case"node":H=t.circle(s+m.legend["indicator-margin-left"]+m.legend["indicator-size"]/2,r+m.legend["indicator-margin-top"]+m.legend["indicator-size"]/2,m.legend["indicator-size"]/2).attr({fill:F.color["color"],"fill-opacity":F.color["dark-alpha"],stroke:F.color["color"],"stroke-opacity":F.color["dark-alpha"],"stroke-width":m.legend["indicator-border-width"]}).translate(0.5,0.5);break;case"sector":var E=m.legend["indicator-sector-angle"]*Math.PI/180;v=[];v.push("M"+(s+m.legend["indicator-margin-left"])+","+(r+m.legend["indicator-margin-top"]+m.legend["indicator-size"]));v.push("L"+(s+m.legend["indicator-margin-left"]+Math.cos(E)*m.legend["indicator-size"])+","+(r+m.legend["indicator-margin-top"]));v.push("A"+m.legend["indicator-size"]+","+m.legend["indicator-size"]+", 0, 0, 1,"+(s+m.legend["indicator-margin-left"]+m.legend["indicator-size"])+","+(r+m.legend["indicator-margin-top"]+m.legend["indicator-size"]));v.push("L"+(s+m.legend["indicator-margin-left"])+","+(r+m.legend["indicator-margin-top"]+m.legend["indicator-size"]));v.push("Z");H=t.path(v.join("")).attr({fill:F.color["color"],"fill-opacity":F.color["light-alpha"],stroke:F.color["color"],"stroke-opacity":F.color["dark-alpha"],"stroke-width":m.legend["indicator-border-width"]}).translate(0.5,0.5);break;case"circle":H=t.circle(s+m.legend["indicator-margin-left"]+m.legend["indicator-size"]/2,r+m.legend["indicator-margin-top"]+m.legend["indicator-size"]/2,m.legend["indicator-size"]/2).attr({fill:F.color["color"],"fill-opacity":F.color["light-alpha"],stroke:F.color["color"],"stroke-opacity":F.color["dark-alpha"],"stroke-width":m.legend["indicator-border-width"]}).translate(0.5,0.5);break}k.push(H);G=t.text(s+m.legend["indicator-margin-left"]+m.legend["indicator-margin-right"]+m.legend["indicator-size"],r+m.legend["indicator-margin-top"]+m.legend["indicator-size"]/2,F.label).attr({"text-anchor":"start",fill:m.legend["label-color"]?m.legend["label-color"]:F.color["color"],"fill-opacity":m.legend["label-alpha"],"font-size":m.legend["label-size"]}).translate(0.5,0.5);r+=m.legend["indicator-size"]+m.legend["indicator-margin-top"]+m.legend["indicator-margin-bottom"]}};b.draw_tooltip=function(r,q,p,t,C,v,w,n,B){if(t===e){return}var m=b.merge_options(n);var u,l,k=0,o=0,A=0,j=0;b.hide_tooltip(m);e=t;u=r.text(-1000,-1000,C).attr({"font-weight":m.tooltip["title-text-weight"],"font-size":m.tooltip["title-text-size"]}).translate(0.5,0.5);l=u.getBBox();k=l.width;o=l.height;u=r.text(-1000,-1000,v).attr({"font-weight":m.tooltip["content-text-weight"],"font-size":m.tooltip["content-text-size"]}).translate(0.5,0.5);l=u.getBBox();A=l.width;j=l.height;var z=(k>A)?k:A;var s=o+j;z+=m.tooltip["padding-left"]+m.tooltip["padding-right"];s+=m.tooltip["padding-top"]+m.tooltip["padding-bottom"]+m.tooltip["line-spacing"];q-=(z/2)+m.tooltip["horizontal-offset"];if(m.tooltip["vertical-offset"]<=0){p-=(s-m.tooltip["vertical-offset"])}else{p+=s+m.tooltip["vertical-offset"]}if(q<m.layout["padding-left"]){q=m.layout["padding-left"]}if(q+z>r.width-m.layout["padding-right"]){q=r.width-m.layout["padding-right"]-z}if(p<m.layout["padding-top"]){p=m.layout["padding-top"]}if(p+s>r.height-m.layout["padding-bottom"]){p=r.height-m.layout["padding-bottom"]-s}a=r.rect(q,p,z,s,m.tooltip["border-radius"]).attr({stroke:m.tooltip["border-color"],"stroke-width":m.tooltip["border-width"],"stroke-opacity":m.tooltip["border-alpha"],fill:m.tooltip["background-color"],"fill-opacity":m.tooltip["background-alpha"],opacity:0}).translate(0.5,0.5);f=r.text(q+m.tooltip["padding-left"],p+m.tooltip["padding-top"]+o/2,C).attr({fill:m.tooltip["title-text-color"]?m.tooltip["title-text-color"]:w.color,"font-size":m.tooltip["title-text-size"],"text-anchor":"start","font-weight":m.tooltip["title-text-weight"],"fill-opacity":m.tooltip["title-text-alpha"],opacity:0}).translate(0.5,0.5);h=r.text(q+m.tooltip["padding-left"],p+m.tooltip["padding-top"]+j+m.tooltip["line-spacing"]+j/2,v).attr({fill:m.tooltip["content-text-color"],"font-size":m.tooltip["content-text-size"],"text-anchor":"start","font-weight":m.tooltip["content-text-weight"],"fill-opacity":m.tooltip["content-text-alpha"],opacity:0}).translate(0.5,0.5);a.stop();f.stop();h.stop();a.animate({opacity:1},m.tooltip["speed"]);f.animate({opacity:1},m.tooltip["speed"]);h.animate({opacity:1},m.tooltip["speed"]);if(m.tooltip["hide-after"]){if(B&&m.tooltip["hide-when"]==="mouse-out"){var i=function(x){clearTimeout(g);g=setTimeout(function(){b.hide_tooltip();e=undefined},m.tooltip["hide-after"])};clearTimeout(g);B.unmouseout(i);B.mouseout(i)}else{clearTimeout(g);g=setTimeout(function(){b.hide_tooltip();e=undefined},m.tooltip["hide-after"])}}};b.element_action=function(i){if(this.data("info")["callback"]&&typeof(this.data("info")["callback"])==="function"){this.data("info")["callback"].call(this.data("info")["that"],b.filter_node(this.data("info"),["callback","that"]))}};b.element_tooltip=function(i){b.draw_tooltip(this.data("tooltip")["paper"],this.data("tooltip")["x"],this.data("tooltip")["y"],this.data("tooltip")["id"],this.data("tooltip")["title"],this.data("tooltip")["content"],this.data("tooltip")["color"],this.data("tooltip")["options"],this.data("tooltip")["element"])};b.filter_node=function(k,j){if(!j||j.length===0){return k}var l,i={};for(l in k){if(j.indexOf(l)===-1){i[l]=k[l]}else{continue}}return i};b.in_array=function(k,l){if(typeof(l)==="object"&&(l instanceof Array)){for(var j=0;j<l.length;++j){if(k==l[j]){return j}}}return -1};b.merge_options=function(j){if(!j){return InfoViz.options}var i={},l,k;for(l in InfoViz.options){if(typeof(InfoViz.options[l])==="object"&&(InfoViz.options[l] instanceof Array)){i[l]=[]}else{i[l]={}}for(k in InfoViz.options[l]){i[l][k]=InfoViz.options[l][k]}}for(l in j){for(k in j[l]){i[l][k]=j[l][k]}}return i};b.hide_tooltip=function(j){var i=b.merge_options(j);if(a){var m=a;m.stop();m.animate({opacity:0},i.tooltip["speed"],function(){m.remove();delete m})}if(f){var k=f;k.stop();k.animate({opacity:0},i.tooltip["speed"],function(){k.remove();delete k})}if(h){var l=h;l.stop();l.animate({opacity:0},i.tooltip["speed"],function(){l.remove();delete l})}};b.is_array=function(i){return Object.prototype.toString.call(i)==="[object Array]"};b.is_number=function(i){return !isNaN(parseFloat(i))&&isFinite(i)}});