define(function(b,a,c){a.draw_linechart=function(g,A,am,N,ab,Y){if(!g||!am){return idb("Paper or Data is empty.")}var L=b("./infoviz.core");var J=L.merge_options(N),C=[],ac,aa;var V=am.data,F=[],ak,aj,ai,Q;var M=am.horizontal_field,h=am.vertical_field,R;var n,an,K=Infinity,ap=-Infinity,W=Infinity,t=-Infinity;var l=Infinity,Z=-Infinity;if(L.is_array(h)){if(h.length===2){R=h[1];h=h[0]}else{h=h[0]}}var U;for(var v in V){if(!V[v]["axis"]||V[v]["axis"]<0||V[v]["axis"]>1){U=0}else{U=V[v]["axis"]}for(ak=0;ak<V[v]["data"].length;++ak){Q=V[v]["data"][ak];if(Q[M]!==undefined){n=Q[M]}else{n="N/A"}if(n>ap){ap=n}if(n<K){K=n}if(L.in_array(n,F)===-1){F.push(n)}if(U===0){if(L.is_number(Q[h])){an=Q[h]}else{an="N/A"}if(an>t){t=an}if(an<W){W=an}}else{if(L.is_number(Q[R])){an=Q[R]}else{an="N/A"}if(an>Z){Z=an}if(an<l){l=an}}}}W=Math.floor(W/10)*10;t=Math.ceil(t/10)*10;l=Math.floor(l/10)*10;Z=Math.ceil(Z/10)*10;var af=A["top-left"][0]+J.linechart["padding-left"];var I=(A["top-right"][0]-J.linechart["padding-right"]-af)/(F.length-1);var ah=A["bottom-left"][1]-J.linechart["padding-bottom"];var X=(ah-A["top-left"][1]-J.linechart["padding-top"])/(t-W);var al=(ah-A["top-left"][1]-J.linechart["padding-top"])/(Z-l);var m={};var D=(ah-A["top-left"][1]-J.linechart["padding-top"])/(J.grid["vertical-label-count"]-1);var r=(t-W)/(J.grid["vertical-label-count"]-1);var ad=(ah-A["top-left"][1]-J.linechart["padding-top"])/(J.grid["vertical-label-count-right"]-1);var B=(Z-l)/(J.grid["vertical-label-count-right"]-1);C=[];ac=A["top-left"][0]-J.grid["vertical-bar-width"];aa=ah;var o=W;for(ak=0;ak<J.grid["vertical-label-count"];++ak){C.push("M"+ac+","+aa+"L"+A["top-left"][0]+","+aa);g.path(C.join("")).attr({stroke:J.grid["axis-color"],"stroke-opacity":J.grid["axis-alpha"],"stroke-width":J.grid["axis-width"]}).translate(0.5,0.5);g.text(ac-J.grid["vertical-bar-width"],aa,o.toFixed(J.grid["vertical-label-round"])).attr({"text-anchor":"end",fill:J.grid["vertical-label-color"],"font-size":J.grid["vertical-label-size"]}).translate(0.5,0.5);aa-=D;o+=r}if(J.grid["enable-right-axis"]){C=[];ac=A["top-right"][0];aa=ah;o=l;for(ak=0;ak<J.grid["vertical-label-count-right"];++ak){C.push("M"+ac+","+aa+"L"+(A["top-right"][0]+J.grid["vertical-bar-width-right"])+","+aa);g.path(C.join("")).attr({stroke:J.grid["axis-color"],"stroke-opacity":J.grid["axis-alpha"],"stroke-width":J.grid["axis-width"]}).translate(0.5,0.5);g.text(ac+2*J.grid["vertical-bar-width-right"],aa,o.toFixed(J.grid["vertical-label-round"])).attr({"text-anchor":"start",fill:J.grid["vertical-label-color"],"font-size":J.grid["vertical-label-size"]}).translate(0.5,0.5);aa-=ad;o+=B}}var s,z,f,u;C=[];ac=af;aa=A["bottom-right"][1]+J.grid["horizontal-name-size"]/2+J.grid["horizontal-label-margin"]*2;for(ak=0;ak<F.length;++ak){C.push("M"+ac+","+A["bottom-left"][1]);C.push("L"+ac+","+A["top-left"][1]);m[F[ak]]=ac;if(J.grid["horizontal-label-rotate"]){f=g.text(-1000,-1000,F[ak]).attr({"text-anchor":"middle","font-size":J.grid["horizontal-label-size"],transform:"r"+J.grid["horizontal-label-rotate"]}).translate(0.5,0.5);u=f.getBBox();z=g.text(ac,aa-J.grid["horizontal-label-margin"]*2+u.height/2,F[ak]).attr({"text-anchor":"middle","font-size":J.grid["horizontal-label-size"],fill:J.grid["horizontal-label-color"],transform:"r"+J.grid["horizontal-label-rotate"]}).translate(0.5,0.5)}else{z=g.text(ac,aa,F[ak]).attr({"text-anchor":"middle","font-size":J.grid["horizontal-label-size"],fill:J.grid["horizontal-label-color"]}).translate(0.5,0.5)}ac+=I}s=g.path(C.join(""));s.attr({stroke:J.grid["grid-color"],"stroke-dasharray":"--..","stroke-linecap":"butt","stroke-width":J.grid["grid-width"],"stroke-opacity":J.grid["grid-alpha"]});s.translate(0.5,0.5);var T=0,O;var ae=[],e=[];for(var v in V){var d,E,q,G,ao=[];var H,P;if(!V[v]["axis"]||V[v]["axis"]<0||V[v]["axis"]>1){U=0}else{U=V[v]["axis"]}C=[];O=J.color[(T%J.color.length)];for(ak=0;ak<V[v]["data"].length;++ak){Q=V[v]["data"][ak];ac=m[Q[M]];if(U===0){aa=ah-(Q[h]-W)*X}else{aa=ah-(Q[R]-l)*al}if(ak===0){C.push("M"+ac+","+aa);H=ac}else{C.push("L"+ac+","+aa)}if(ak===V[v]["data"].length-1){P=ac}if(U===0){ao.push({x:ac,y:aa,axis:U,v_value:Q[h],h_value:Q[M],data:Q})}else{ao.push({x:ac,y:aa,axis:U,v_value:Q[R],h_value:Q[M],data:Q})}}if(U===0){d=g.path(C.join("")).attr({stroke:O.color,"stroke-opacity":O["light-alpha"],"stroke-width":J.linechart["line-width"]}).translate(0.5,0.5)}else{d=g.path(C.join("")).attr({stroke:O.color,"stroke-dasharray":"-.","stroke-linecap":"butt","stroke-opacity":O["light-alpha"],"stroke-width":J.linechart["line-width"]}).translate(0.5,0.5)}q=g.text(ac+J.linechart["circle-radius"]*2,aa,V[v]["name"]).attr({fill:O.color,"text-anchor":"start","font-size":J.linechart["label-size"]}).translate(0.5,0.5);if(J.linechart["area-enabled"]){C.push("L"+P+","+A["bottom-left"][1]);C.push("L"+H+","+A["bottom-left"][1]);C.push("Z");G=g.path(C.join("")).attr({stroke:"none",fill:O.color,"fill-opacity":J.linechart["area-alpha"]}).translate(0.5,0.5)}for(ak=0;ak<ao.length;++ak){if(J.linechart["custom-circle"]){E=g.image(J.linechart["custom-circle"],ao[ak]["x"]-J.linechart["circle-radius"],ao[ak]["y"]-J.linechart["circle-radius"],J.linechart["circle-radius"]*2,J.linechart["circle-radius"]*2).attr({cursor:"pointer"}).translate(0.5,0.5)}else{E=g.circle(ao[ak]["x"],ao[ak]["y"],J.linechart["circle-radius"]).attr({stroke:O.color,"stroke-opacity":O["dark-alpha"],"stroke-width":J.linechart["line-width"],fill:O.color}).translate(0.5,0.5)}e.push(E);if(ab&&typeof(ab)==="function"){E.data("info",{data:ao[ak]["data"],x:ao[ak]["x"],y:ao[ak]["y"],v_value:ao[ak]["v_value"],h_value:ao[ak]["h_value"],that:Y,callback:ab});E.click(L.element_action)}if(am.tooltip_title||am.tooltip_content){var S=am.tooltip_title;var w=am.tooltip_content;for(var ag in ao[ak]["data"]){S=S.replace("{"+ag+"}",ao[ak]["data"][ag]);w=w.replace("{"+ag+"}",ao[ak]["data"][ag])}E.data("tooltip",{id:v+ak,title:S,content:w,color:O,x:ao[ak]["x"],y:ao[ak]["y"],element:E,options:J,paper:g});E.hover(L.element_tooltip)}}if(J.linechart["area-enabled"]){ae.push({label:V[v]["name"],color:O,type:"area"})}else{ae.push({label:V[v]["name"],color:O,type:"line"})}T++}for(ak=0;ak<e.length;++ak){e[ak].toFront()}L.draw_legend(g,A,ae,J)}});